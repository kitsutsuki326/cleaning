<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊéÉÈô§„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide icons as inline SVG components
        const Home = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                <polyline points="9 22 9 12 15 12 15 22"></polyline>
            </svg>
        );
        
        const Droplets = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M7 16.3c2.2 0 4-1.83 4-4.05 0-1.16-.57-2.26-1.71-3.19S7.29 6.75 7 5.3c-.29 1.45-1.14 2.84-2.29 3.76S3 11.1 3 12.25c0 2.22 1.8 4.05 4 4.05z"></path>
                <path d="M12.56 6.6A10.97 10.97 0 0 0 14 3.02c.5 2.5 2 4.9 4 6.5s3 3.5 3 5.5a6.98 6.98 0 0 1-11.91 4.97"></path>
            </svg>
        );
        
        const Bath = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M9 6 6.5 3.5a1.5 1.5 0 0 0-1-.5C4.683 3 4 3.683 4 4.5V17a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5"></path>
                <line x1="10" x2="8" y1="5" y2="7"></line>
                <line x1="2" x2="22" y1="12" y2="12"></line>
                <line x1="7" x2="7" y1="19" y2="21"></line>
                <line x1="17" x2="17" y1="19" y2="21"></line>
            </svg>
        );
        
        const Bed = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M2 4v16"></path>
                <path d="M2 8h18a2 2 0 0 1 2 2v10"></path>
                <path d="M2 17h20"></path>
                <path d="M6 8v9"></path>
            </svg>
        );
        
        const Utensils = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2"></path>
                <path d="M7 2v20"></path>
                <path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7"></path>
            </svg>
        );
        
        const Coffee = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M17 8h1a4 4 0 1 1 0 8h-1"></path>
                <path d="M3 8h14v9a4 4 0 0 1-4 4H7a4 4 0 0 1-4-4Z"></path>
                <line x1="6" x2="6" y1="2" y2="4"></line>
                <line x1="10" x2="10" y1="2" y2="4"></line>
                <line x1="14" x2="14" y1="2" y2="4"></line>
            </svg>
        );
        
        const Plus = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="12" x2="12" y1="5" y2="19"></line>
                <line x1="5" x2="19" y1="12" y2="12"></line>
            </svg>
        );
        
        const Trash2 = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="3 6 5 6 21 6"></polyline>
                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                <line x1="10" x2="10" y1="11" y2="17"></line>
                <line x1="14" x2="14" y1="11" y2="17"></line>
            </svg>
        );
        
        const Check = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="20 6 9 17 4 12"></polyline>
            </svg>
        );
        
        const AlertCircle = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" x2="12" y1="8" y2="12"></line>
                <line x1="12" x2="12.01" y1="16" y2="16"></line>
            </svg>
        );

        const Undo = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M3 7v6h6"></path>
                <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"></path>
            </svg>
        );

        const ListTodo = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="5" width="6" height="6" rx="1"></rect>
                <path d="m3 17 2 2 4-4"></path>
                <path d="M13 6h8"></path>
                <path d="M13 12h8"></path>
                <path d="M13 18h8"></path>
            </svg>
        );

        const Calendar = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                <line x1="16" x2="16" y1="2" y2="6"></line>
                <line x1="8" x2="8" y1="2" y2="6"></line>
                <line x1="3" x2="21" y1="10" y2="10"></line>
            </svg>
        );

        const Bell = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"></path>
                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
            </svg>
        );

        const BellOff = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5"></path>
                <path d="M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7"></path>
                <path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"></path>
                <line x1="1" x2="23" y1="1" y2="23"></line>
            </svg>
        );

        const Download = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" x2="12" y1="15" y2="3"></line>
            </svg>
        );

        const X = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <line x1="18" x2="6" y1="6" y2="18"></line>
                <line x1="6" x2="18" y1="6" y2="18"></line>
            </svg>
        );

        const ChevronDown = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
        );

        const ChevronUp = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <polyline points="18 15 12 9 6 15"></polyline>
            </svg>
        );

        function CleaningScheduleApp() {
          const [rooms, setRooms] = useState([]);
          const [showAddRoom, setShowAddRoom] = useState(false);
          const [expandedRoom, setExpandedRoom] = useState(null);
          const [newTaskText, setNewTaskText] = useState('');
          const [notificationsEnabled, setNotificationsEnabled] = useState(false);
          const [newRoom, setNewRoom] = useState({
            name: '',
            frequency: 7,
            icon: 'home'
          });

          const iconOptions = [
            { value: 'home', label: '„É™„Éì„É≥„Ç∞', Icon: Home },
            { value: 'droplets', label: '„Éê„Çπ„É´„Éº„É†', Icon: Droplets },
            { value: 'bath', label: '„Éà„Ç§„É¨', Icon: Bath },
            { value: 'bed', label: 'ÂØùÂÆ§', Icon: Bed },
            { value: 'utensils', label: '„Ç≠„ÉÉ„ÉÅ„É≥', Icon: Utensils },
            { value: 'coffee', label: '„ÉÄ„Ç§„Éã„É≥„Ç∞', Icon: Coffee },
          ];

          useEffect(() => {
            try {
              const saved = localStorage.getItem('cleaning-rooms');
              if (saved) {
                setRooms(JSON.parse(saved));
              }
            } catch (error) {
              console.log('No existing rooms found');
            }
          }, []);

          useEffect(() => {
            if (rooms.length >= 0) {
              try {
                localStorage.setItem('cleaning-rooms', JSON.stringify(rooms));
              } catch (error) {
                console.error('Failed to save rooms:', error);
              }
            }
          }, [rooms]);

          const addRoom = () => {
            if (newRoom.name.trim()) {
              setRooms([...rooms, {
                id: Date.now(),
                name: newRoom.name,
                frequency: newRoom.frequency,
                icon: newRoom.icon,
                lastCleaned: null,
                history: [],
                tasks: []
              }]);
              setNewRoom({ name: '', frequency: 7, icon: 'home' });
              setShowAddRoom(false);
            }
          };

          const markAsCleaned = (id) => {
            const now = new Date().toISOString();
            setRooms(rooms.map(room =>
              room.id === id
                ? {
                    ...room,
                    lastCleaned: now,
                    history: [...(room.history || []), now].slice(-10),
                    tasks: (room.tasks || []).map(t => ({ ...t, completed: false }))
                  }
                : room
            ));
          };

          const deleteRoom = (id) => {
            setRooms(rooms.filter(room => room.id !== id));
          };

          // Undo last cleaning
          const undoLastClean = (id) => {
            setRooms(rooms.map(room => {
              if (room.id !== id) return room;
              const history = [...(room.history || [])];
              history.pop(); // Remove the last entry
              const previousClean = history.length > 0 ? history[history.length - 1] : null;
              return { ...room, lastCleaned: previousClean, history };
            }));
          };

          // Per-room task management
          const addTask = (roomId, taskName) => {
            if (!taskName.trim()) return;
            setRooms(rooms.map(room => {
              if (room.id !== roomId) return room;
              const tasks = [...(room.tasks || []), { id: Date.now(), name: taskName.trim(), completed: false }];
              return { ...room, tasks };
            }));
            setNewTaskText('');
          };

          const toggleTask = (roomId, taskId) => {
            setRooms(rooms.map(room => {
              if (room.id !== roomId) return room;
              const tasks = (room.tasks || []).map(t =>
                t.id === taskId ? { ...t, completed: !t.completed } : t
              );
              return { ...room, tasks };
            }));
          };

          const deleteTask = (roomId, taskId) => {
            setRooms(rooms.map(room => {
              if (room.id !== roomId) return room;
              const tasks = (room.tasks || []).filter(t => t.id !== taskId);
              return { ...room, tasks };
            }));
          };

          // Calendar export (.ics)
          const exportToCalendar = (room) => {
            const nextDue = new Date();
            if (room.lastCleaned) {
              const last = new Date(room.lastCleaned);
              nextDue.setTime(last.getTime() + room.frequency * 24 * 60 * 60 * 1000);
            }
            if (nextDue < new Date()) {
              nextDue.setTime(Date.now());
            }

            const formatDate = (d) => {
              return d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';
            };

            const endDate = new Date(nextDue.getTime() + 60 * 60 * 1000); // 1 hour event

            const icsContent = [
              'BEGIN:VCALENDAR',
              'VERSION:2.0',
              'PRODID:-//Cleaning Schedule//JP',
              'BEGIN:VEVENT',
              `DTSTART:${formatDate(nextDue)}`,
              `DTEND:${formatDate(endDate)}`,
              `SUMMARY:${room.name}„ÅÆÊéÉÈô§`,
              `DESCRIPTION:${room.name}„ÅÆÂÆöÊúüÊéÉÈô§Ôºà${room.frequency}Êó•„Åî„Å®Ôºâ`,
              `RRULE:FREQ=DAILY;INTERVAL=${room.frequency}`,
              'BEGIN:VALARM',
              'TRIGGER:-PT30M',
              'ACTION:DISPLAY',
              `DESCRIPTION:${room.name}„ÅÆÊéÉÈô§„ÅÆÊôÇÈñì„Åß„Åô`,
              'END:VALARM',
              'END:VEVENT',
              'END:VCALENDAR'
            ].join('\r\n');

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${room.name}_ÊéÉÈô§„Çπ„Ç±„Ç∏„É•„Éº„É´.ics`;
            a.click();
            URL.revokeObjectURL(url);
          };

          const exportAllToCalendar = () => {
            const events = rooms.map(room => {
              const nextDue = new Date();
              if (room.lastCleaned) {
                const last = new Date(room.lastCleaned);
                nextDue.setTime(last.getTime() + room.frequency * 24 * 60 * 60 * 1000);
              }
              if (nextDue < new Date()) {
                nextDue.setTime(Date.now());
              }
              const endDate = new Date(nextDue.getTime() + 60 * 60 * 1000);
              const formatDate = (d) => d.toISOString().replace(/[-:]/g, '').split('.')[0] + 'Z';

              return [
                'BEGIN:VEVENT',
                `UID:cleaning-${room.id}@schedule`,
                `DTSTART:${formatDate(nextDue)}`,
                `DTEND:${formatDate(endDate)}`,
                `SUMMARY:${room.name}„ÅÆÊéÉÈô§`,
                `DESCRIPTION:${room.name}„ÅÆÂÆöÊúüÊéÉÈô§Ôºà${room.frequency}Êó•„Åî„Å®Ôºâ`,
                `RRULE:FREQ=DAILY;INTERVAL=${room.frequency}`,
                'BEGIN:VALARM',
                'TRIGGER:-PT30M',
                'ACTION:DISPLAY',
                `DESCRIPTION:${room.name}„ÅÆÊéÉÈô§„ÅÆÊôÇÈñì„Åß„Åô`,
                'END:VALARM',
                'END:VEVENT'
              ].join('\r\n');
            });

            const icsContent = [
              'BEGIN:VCALENDAR',
              'VERSION:2.0',
              'PRODID:-//Cleaning Schedule//JP',
              ...events,
              'END:VCALENDAR'
            ].join('\r\n');

            const blob = new Blob([icsContent], { type: 'text/calendar;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'ÊéÉÈô§„Çπ„Ç±„Ç∏„É•„Éº„É´_ÂÖ®ÈÉ®Â±ã.ics';
            a.click();
            URL.revokeObjectURL(url);
          };

          // Notification functionality
          const requestNotificationPermission = async () => {
            if (!('Notification' in window)) {
              alert('„Åì„ÅÆ„Éñ„É©„Ç¶„Ç∂„ÅØÈÄöÁü•Ê©üËÉΩ„Å´ÂØæÂøú„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì');
              return;
            }
            const permission = await Notification.requestPermission();
            if (permission === 'granted') {
              setNotificationsEnabled(true);
              localStorage.setItem('cleaning-notifications', 'true');
              new Notification('ÊéÉÈô§„Çπ„Ç±„Ç∏„É•„Éº„É´', {
                body: 'ÈÄöÁü•„ÅåÊúâÂäπ„Å´„Å™„Çä„Åæ„Åó„ÅüÔºÅÊéÉÈô§„ÅåÂøÖË¶Å„Å™ÊôÇ„Å´„ÅäÁü•„Çâ„Åõ„Åó„Åæ„Åô„ÄÇ',
                icon: 'üßπ'
              });
            } else {
              setNotificationsEnabled(false);
              localStorage.setItem('cleaning-notifications', 'false');
            }
          };

          const disableNotifications = () => {
            setNotificationsEnabled(false);
            localStorage.setItem('cleaning-notifications', 'false');
          };

          const sendNotification = (title, body) => {
            if (notificationsEnabled && 'Notification' in window && Notification.permission === 'granted') {
              new Notification(title, { body });
            }
          };

          // Check notifications on load and periodically
          useEffect(() => {
            const saved = localStorage.getItem('cleaning-notifications');
            if (saved === 'true' && 'Notification' in window && Notification.permission === 'granted') {
              setNotificationsEnabled(true);
            }
          }, []);

          useEffect(() => {
            if (!notificationsEnabled || rooms.length === 0) return;

            const checkAndNotify = () => {
              const overdueRooms = rooms.filter(r => getUrgencyLevel(r) === 'overdue');
              const urgentRooms = rooms.filter(r => getUrgencyLevel(r) === 'urgent');

              if (overdueRooms.length > 0) {
                sendNotification(
                  'Ëá≥ÊÄ•: ÊéÉÈô§„ÅåÂøÖË¶Å„Åß„ÅôÔºÅ',
                  `${overdueRooms.map(r => r.name).join('„ÄÅ')} „ÅÆÊéÉÈô§„ÅåÂ§ßÂπÖ„Å´ÈÅÖ„Çå„Å¶„ÅÑ„Åæ„Åô`
                );
              } else if (urgentRooms.length > 0) {
                sendNotification(
                  'ÊéÉÈô§„ÅÆ„ÅäÁü•„Çâ„Åõ',
                  `${urgentRooms.map(r => r.name).join('„ÄÅ')} „ÅÆÊéÉÈô§ÊôÇÊúü„Åß„Åô`
                );
              }
            };

            // Check once on mount/change
            const lastNotified = localStorage.getItem('cleaning-last-notified');
            const now = Date.now();
            // Only notify once per hour
            if (!lastNotified || now - parseInt(lastNotified) > 60 * 60 * 1000) {
              checkAndNotify();
              localStorage.setItem('cleaning-last-notified', now.toString());
            }

            // Check every hour
            const interval = setInterval(() => {
              checkAndNotify();
              localStorage.setItem('cleaning-last-notified', Date.now().toString());
            }, 60 * 60 * 1000);

            return () => clearInterval(interval);
          }, [notificationsEnabled, rooms]);

          const getDaysSinceLastCleaned = (lastCleaned) => {
            if (!lastCleaned) return null;
            const now = new Date();
            const last = new Date(lastCleaned);
            return Math.floor((now - last) / (1000 * 60 * 60 * 24));
          };

          const getUrgencyLevel = (room) => {
            const daysSince = getDaysSinceLastCleaned(room.lastCleaned);
            if (daysSince === null) return 'never';
            
            const ratio = daysSince / room.frequency;
            if (ratio >= 1.5) return 'overdue';
            if (ratio >= 1) return 'urgent';
            if (ratio >= 0.7) return 'soon';
            return 'clean';
          };

          const getUrgencyColor = (level) => {
            switch (level) {
              case 'never': return 'bg-gray-100 border-gray-300 text-gray-600';
              case 'overdue': return 'bg-red-50 border-red-400 text-red-800 shadow-lg shadow-red-100';
              case 'urgent': return 'bg-orange-50 border-orange-400 text-orange-800 shadow-md shadow-orange-100';
              case 'soon': return 'bg-yellow-50 border-yellow-400 text-yellow-800';
              case 'clean': return 'bg-green-50 border-green-400 text-green-800';
              default: return 'bg-gray-100 border-gray-300';
            }
          };

          const getUrgencyMessage = (room) => {
            const level = getUrgencyLevel(room);
            const daysSince = getDaysSinceLastCleaned(room.lastCleaned);
            
            if (level === 'never') return 'Êú™ÊéÉÈô§';
            if (level === 'overdue') return `${daysSince}Êó•ÁµåÈÅé - Ëá≥ÊÄ•ÔºÅ`;
            if (level === 'urgent') return `${daysSince}Êó•ÁµåÈÅé - ÊéÉÈô§„ÅåÂøÖË¶Å`;
            if (level === 'soon') return `${daysSince}Êó•ÁµåÈÅé - „Åù„Çç„Åù„Çç`;
            return `${daysSince}Êó•ÁµåÈÅé - „Åæ„Å†Á∂∫È∫ó`;
          };

          const getIconComponent = (iconValue) => {
            const option = iconOptions.find(opt => opt.value === iconValue);
            return option ? option.Icon : Home;
          };

          const sortedRooms = [...rooms].sort((a, b) => {
            const urgencyOrder = { overdue: 0, urgent: 1, never: 2, soon: 3, clean: 4 };
            return urgencyOrder[getUrgencyLevel(a)] - urgencyOrder[getUrgencyLevel(b)];
          });

          const stats = {
            total: rooms.length,
            overdue: rooms.filter(r => getUrgencyLevel(r) === 'overdue').length,
            urgent: rooms.filter(r => getUrgencyLevel(r) === 'urgent').length,
            clean: rooms.filter(r => getUrgencyLevel(r) === 'clean').length,
          };

          return (
            <div className="min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-50 p-4 sm:p-8">
              <div className="max-w-4xl mx-auto">
                <div className="bg-white rounded-2xl shadow-xl overflow-hidden mb-6">
                  <div className="bg-gradient-to-r from-blue-600 to-indigo-700 p-6 sm:p-8">
                    <div className="flex items-start justify-between">
                      <div>
                        <h1 className="text-3xl sm:text-4xl font-bold text-white mb-2 flex items-center gap-3">
                          <Home size={36} />
                          ÊéÉÈô§„Çπ„Ç±„Ç∏„É•„Éº„É´ÁÆ°ÁêÜ
                        </h1>
                        <p className="text-blue-100">
                          ÈÉ®Â±ã„Åî„Å®„ÅÆÊéÉÈô§Áä∂Ê≥Å„Çí‰∏ÄÁõÆ„ÅßÁ¢∫Ë™ç
                        </p>
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={notificationsEnabled ? disableNotifications : requestNotificationPermission}
                          className={`p-2 rounded-lg transition-colors ${
                            notificationsEnabled
                              ? 'bg-white/20 text-white hover:bg-white/30'
                              : 'bg-white/10 text-blue-200 hover:bg-white/20'
                          }`}
                          title={notificationsEnabled ? 'ÈÄöÁü•„Çí„Ç™„Éï„Å´„Åô„Çã' : 'ÈÄöÁü•„Çí„Ç™„É≥„Å´„Åô„Çã'}
                        >
                          {notificationsEnabled ? <Bell size={20} /> : <BellOff size={20} />}
                        </button>
                        {rooms.length > 0 && (
                          <button
                            onClick={exportAllToCalendar}
                            className="p-2 rounded-lg bg-white/10 text-blue-200 hover:bg-white/20 transition-colors"
                            title="ÂÖ®ÈÉ®Â±ã„ÅÆ„Çπ„Ç±„Ç∏„É•„Éº„É´„Çí„Ç´„É¨„É≥„ÉÄ„Éº„Å´„Ç®„ÇØ„Çπ„Éù„Éº„Éà"
                          >
                            <Calendar size={20} />
                          </button>
                        )}
                      </div>
                    </div>
                  </div>

                  <div className="grid grid-cols-2 sm:grid-cols-4 gap-4 p-6 bg-gray-50">
                    <div className="text-center">
                      <div className="text-2xl font-bold text-gray-800">{stats.total}</div>
                      <div className="text-xs text-gray-600">ÁôªÈå≤ÈÉ®Â±ãÊï∞</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-red-600">{stats.overdue}</div>
                      <div className="text-xs text-gray-600">Ëá≥ÊÄ•</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-orange-600">{stats.urgent}</div>
                      <div className="text-xs text-gray-600">Ë¶ÅÊéÉÈô§</div>
                    </div>
                    <div className="text-center">
                      <div className="text-2xl font-bold text-green-600">{stats.clean}</div>
                      <div className="text-xs text-gray-600">Á∂∫È∫ó</div>
                    </div>
                  </div>
                </div>

                {!showAddRoom && (
                  <button
                    onClick={() => setShowAddRoom(true)}
                    className="w-full mb-6 bg-white hover:bg-blue-50 border-2 border-dashed border-blue-300 rounded-xl p-4 text-blue-600 font-medium transition-colors flex items-center justify-center gap-2"
                  >
                    <Plus size={20} />
                    Êñ∞„Åó„ÅÑÈÉ®Â±ã„ÇíËøΩÂä†
                  </button>
                )}

                {showAddRoom && (
                  <div className="bg-white rounded-xl shadow-lg p-6 mb-6 border-2 border-blue-300">
                    <h3 className="font-bold text-lg mb-4 text-gray-800">Êñ∞„Åó„ÅÑÈÉ®Â±ã„ÇíËøΩÂä†</h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ÈÉ®Â±ãÂêç
                        </label>
                        <input
                          type="text"
                          value={newRoom.name}
                          onChange={(e) => setNewRoom({ ...newRoom, name: e.target.value })}
                          placeholder="‰æã: „É™„Éì„É≥„Ç∞„ÄÅ„Ç≠„ÉÉ„ÉÅ„É≥"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          ÊéÉÈô§È†ªÂ∫¶ÔºàÊó•Êï∞Ôºâ
                        </label>
                        <input
                          type="number"
                          value={newRoom.frequency}
                          onChange={(e) => setNewRoom({ ...newRoom, frequency: parseInt(e.target.value) })}
                          min="1"
                          className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                        <p className="text-xs text-gray-500 mt-1">
                          {newRoom.frequency}Êó•„Åî„Å®„Å´ÊéÉÈô§„ÅåÂøÖË¶Å
                        </p>
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">
                          „Ç¢„Ç§„Ç≥„É≥
                        </label>
                        <div className="grid grid-cols-3 sm:grid-cols-6 gap-2">
                          {iconOptions.map(({ value, label, Icon }) => (
                            <button
                              key={value}
                              onClick={() => setNewRoom({ ...newRoom, icon: value })}
                              className={`p-3 rounded-lg border-2 transition-all ${
                                newRoom.icon === value
                                  ? 'border-blue-500 bg-blue-50'
                                  : 'border-gray-200 hover:border-blue-300'
                              }`}
                            >
                              <Icon size={24} className="mx-auto" />
                              <div className="text-xs mt-1">{label}</div>
                            </button>
                          ))}
                        </div>
                      </div>
                      <div className="flex gap-2">
                        <button
                          onClick={addRoom}
                          className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 rounded-lg font-medium transition-colors"
                        >
                          ËøΩÂä†
                        </button>
                        <button
                          onClick={() => setShowAddRoom(false)}
                          className="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-2 rounded-lg font-medium transition-colors"
                        >
                          „Ç≠„É£„É≥„Çª„É´
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                <div className="space-y-4">
                  {sortedRooms.length === 0 ? (
                    <div className="bg-white rounded-xl p-12 text-center text-gray-400 shadow">
                      <Home size={48} className="mx-auto mb-4 opacity-50" />
                      <p className="text-lg">ÈÉ®Â±ã„ÇíËøΩÂä†„Åó„Å¶ÊéÉÈô§„Çπ„Ç±„Ç∏„É•„Éº„É´„ÇíÁÆ°ÁêÜ„Åó„Åæ„Åó„Çá„ÅÜ</p>
                    </div>
                  ) : (
                    sortedRooms.map(room => {
                      const IconComponent = getIconComponent(room.icon);
                      const urgencyLevel = getUrgencyLevel(room);
                      const urgencyColor = getUrgencyColor(urgencyLevel);
                      const isExpanded = expandedRoom === room.id;
                      const tasks = room.tasks || [];
                      const completedTasks = tasks.filter(t => t.completed).length;

                      return (
                        <div
                          key={room.id}
                          className={`rounded-xl p-6 border-2 transition-all ${urgencyColor}`}
                        >
                          <div className="flex items-start justify-between mb-4">
                            <div className="flex items-center gap-3">
                              <div className="bg-white p-3 rounded-lg shadow-sm">
                                <IconComponent size={28} />
                              </div>
                              <div>
                                <h3 className="font-bold text-xl">{room.name}</h3>
                                <p className="text-sm opacity-75">
                                  {room.frequency}Êó•„Åî„Å®„Å´ÊéÉÈô§
                                  {tasks.length > 0 && ` „Éª „Çø„Çπ„ÇØ ${completedTasks}/${tasks.length}`}
                                </p>
                              </div>
                            </div>
                            <div className="flex items-center gap-1">
                              <button
                                onClick={() => exportToCalendar(room)}
                                className="text-gray-400 hover:text-blue-600 transition-colors p-1"
                                title="„Ç´„É¨„É≥„ÉÄ„Éº„Å´„Ç®„ÇØ„Çπ„Éù„Éº„Éà"
                              >
                                <Calendar size={18} />
                              </button>
                              <button
                                onClick={() => deleteRoom(room.id)}
                                className="text-gray-400 hover:text-red-600 transition-colors p-1"
                              >
                                <Trash2 size={18} />
                              </button>
                            </div>
                          </div>

                          <div className="flex items-center justify-between">
                            <div className="flex items-center gap-2">
                              {urgencyLevel === 'overdue' && <AlertCircle size={20} />}
                              <span className="font-semibold">
                                {getUrgencyMessage(room)}
                              </span>
                            </div>
                            <div className="flex items-center gap-2">
                              {room.lastCleaned && room.history && room.history.length > 0 && (
                                <button
                                  onClick={() => undoLastClean(room.id)}
                                  className="bg-white hover:bg-opacity-80 px-3 py-2 rounded-lg font-medium shadow-sm transition-all flex items-center gap-1 text-sm"
                                  title="ÊéÉÈô§ÂÆå‰∫Ü„ÇíÂèñ„ÇäÊ∂à„Åó"
                                >
                                  <Undo size={16} />
                                  ÂèñÊ∂à
                                </button>
                              )}
                              <button
                                onClick={() => markAsCleaned(room.id)}
                                className="bg-white hover:bg-opacity-80 px-4 py-2 rounded-lg font-medium shadow-sm transition-all flex items-center gap-2"
                              >
                                <Check size={18} />
                                ÊéÉÈô§ÂÆå‰∫Ü
                              </button>
                            </div>
                          </div>

                          {room.lastCleaned && (
                            <div className="mt-3 pt-3 border-t border-current border-opacity-20">
                              <p className="text-sm opacity-75">
                                ÊúÄÁµÇÊéÉÈô§: {new Date(room.lastCleaned).toLocaleDateString('ja-JP')}
                              </p>
                            </div>
                          )}

                          {/* Per-room tasks section */}
                          <div className="mt-3 pt-3 border-t border-current border-opacity-20">
                            <button
                              onClick={() => setExpandedRoom(isExpanded ? null : room.id)}
                              className="flex items-center gap-2 text-sm font-medium opacity-75 hover:opacity-100 transition-opacity w-full"
                            >
                              <ListTodo size={16} />
                              „Çø„Çπ„ÇØ‰∏ÄË¶ß
                              {tasks.length > 0 && (
                                <span className="bg-white/50 px-2 py-0.5 rounded-full text-xs">
                                  {completedTasks}/{tasks.length}
                                </span>
                              )}
                              {isExpanded ? <ChevronUp size={16} className="ml-auto" /> : <ChevronDown size={16} className="ml-auto" />}
                            </button>

                            {isExpanded && (
                              <div className="mt-3 space-y-2">
                                {tasks.map(task => (
                                  <div key={task.id} className="flex items-center gap-2 bg-white/50 rounded-lg px-3 py-2">
                                    <input
                                      type="checkbox"
                                      checked={task.completed}
                                      onChange={() => toggleTask(room.id, task.id)}
                                      className="w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"
                                    />
                                    <span className={`flex-1 text-sm ${task.completed ? 'line-through opacity-50' : ''}`}>
                                      {task.name}
                                    </span>
                                    <button
                                      onClick={() => deleteTask(room.id, task.id)}
                                      className="text-gray-400 hover:text-red-500 transition-colors"
                                    >
                                      <X size={14} />
                                    </button>
                                  </div>
                                ))}

                                <div className="flex gap-2">
                                  <input
                                    type="text"
                                    value={expandedRoom === room.id ? newTaskText : ''}
                                    onChange={(e) => setNewTaskText(e.target.value)}
                                    onKeyDown={(e) => {
                                      if (e.key === 'Enter') {
                                        addTask(room.id, newTaskText);
                                      }
                                    }}
                                    placeholder="Êñ∞„Åó„ÅÑ„Çø„Çπ„ÇØ„ÇíËøΩÂä†..."
                                    className="flex-1 px-3 py-1.5 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                  />
                                  <button
                                    onClick={() => addTask(room.id, newTaskText)}
                                    className="bg-white hover:bg-gray-50 px-3 py-1.5 rounded-lg text-sm font-medium shadow-sm transition-colors flex items-center gap-1"
                                  >
                                    <Plus size={14} />
                                    ËøΩÂä†
                                  </button>
                                </div>
                              </div>
                            )}
                          </div>
                        </div>
                      );
                    })
                  )}
                </div>
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<CleaningScheduleApp />);
    </script>
</body>
</html>
