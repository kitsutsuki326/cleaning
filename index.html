<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>プロ掃除スケジュール管理</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide-like Icons
        const Icons = {
            Home: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>,
            Check: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
            Plus: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" x2="12" y1="5" y2="19"/><line x1="5" x2="19" y1="12" y2="12"/></svg>,
            Trash: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>,
            Settings: ({size=24}) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>
        };

        function App() {
            const [rooms, setRooms] = useState([]);
            const [showAddRoom, setShowAddRoom] = useState(false);
            const [editingRoomId, setEditingRoomId] = useState(null);
            
            // 部屋追加用の一時ステート
            const [roomForm, setRoomForm] = useState({ name: '', icon: 'Home' });

            useEffect(() => {
                const saved = localStorage.getItem('cleaning-pro-v1');
                if (saved) setRooms(JSON.parse(saved));
            }, []);

            useEffect(() => {
                localStorage.setItem('cleaning-pro-v1', JSON.stringify(rooms));
            }, [rooms]);

            const addRoom = () => {
                if (!roomForm.name) return;
                setRooms([...rooms, { id: Date.now(), ...roomForm, tasks: [] }]);
                setRoomForm({ name: '', icon: 'Home' });
                setShowAddRoom(false);
            };

            const addTask = (roomId, taskName, freq) => {
                setRooms(rooms.map(room => {
                    if (room.id === roomId) {
                        return {
                            ...room,
                            tasks: [...room.tasks, {
                                id: Date.now(),
                                name: taskName,
                                frequency: parseInt(freq),
                                lastCleaned: null
                            }]
                        };
                    }
                    return room;
                }));
            };

            const completeTask = (roomId, taskId) => {
                setRooms(rooms.map(room => {
                    if (room.id === roomId) {
                        return {
                            ...room,
                            tasks: room.tasks.map(t => 
                                t.id === taskId ? { ...t, lastCleaned: new Date().toISOString() } : t
                            )
                        };
                    }
                    return room;
                }));
                // 紙吹雪の演出
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.7 }, zIndex: 999 });
            };

            const deleteTask = (roomId, taskId) => {
                setRooms(rooms.map(room => {
                    if (room.id === roomId) {
                        return { ...room, tasks: room.tasks.filter(t => t.id !== taskId) };
                    }
                    return room;
                }));
            };

            const getUrgency = (lastCleaned, frequency) => {
                if (!lastCleaned) return 'never';
                const days = Math.floor((new Date() - new Date(lastCleaned)) / (1000 * 60 * 60 * 24));
                const ratio = days / frequency;
                if (ratio >= 1.2) return 'overdue';
                if (ratio >= 1) return 'urgent';
                return 'clean';
            };

            return (
                <div className="min-h-screen bg-slate-50 p-4 pb-20">
                    <header className="max-w-2xl mx-auto mb-8 pt-4">
                        <h1 className="text-3xl font-black text-slate-800 flex items-center gap-2">
                            <span className="bg-blue-600 text-white p-2 rounded-xl"><Icons.Home size={28}/></span>
                            掃除マスター
                        </h1>
                    </header>

                    <main className="max-w-2xl mx-auto space-y-6">
                        {rooms.map(room => (
                            <div key={room.id} className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                                <div className="p-4 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                                    <h2 className="font-bold text-lg text-slate-700">{room.name}</h2>
                                    <button 
                                        onClick={() => setEditingRoomId(editingRoomId === room.id ? null : room.id)}
                                        className="text-slate-400 hover:text-blue-600 transition-colors"
                                    >
                                        <Icons.Settings size={18}/>
                                    </button>
                                </div>
                                
                                <div className="p-4 space-y-3">
                                    {room.tasks.length === 0 && (
                                        <p className="text-sm text-slate-400 text-center py-4">タスクがありません</p>
                                    )}
                                    {room.tasks.map(task => {
                                        const urgency = getUrgency(task.lastCleaned, task.frequency);
                                        const colors = {
                                            never: 'bg-slate-100 text-slate-600',
                                            overdue: 'bg-red-100 text-red-700 border-red-200',
                                            urgent: 'bg-orange-100 text-orange-700 border-orange-200',
                                            clean: 'bg-green-100 text-green-700 border-green-200'
                                        };
                                        return (
                                            <div key={task.id} className={`flex items-center justify-between p-3 rounded-xl border ${colors[urgency]}`}>
                                                <div>
                                                    <div className="font-bold">{task.name}</div>
                                                    <div className="text-xs opacity-70">頻度: {task.frequency}日ごと</div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <button 
                                                        onClick={() => completeTask(room.id, task.id)}
                                                        className="bg-white/80 hover:bg-white p-2 rounded-lg shadow-sm transition-all"
                                                    >
                                                        <Icons.Check size={20}/>
                                                    </button>
                                                    {editingRoomId === room.id && (
                                                        <button onClick={() => deleteTask(room.id, task.id)} className="text-red-400 p-1">
                                                            <Icons.Trash size={16}/>
                                                        </button>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}

                                    {/* タスク追加フォーム */}
                                    <div className="pt-2">
                                        <form onSubmit={(e) => {
                                            e.preventDefault();
                                            addTask(room.id, e.target.tName.value, e.target.tFreq.value);
                                            e.target.reset();
                                        }} className="flex gap-2">
                                            <input name="tName" placeholder="タスク名" className="flex-1 text-sm border rounded-lg px-3 py-1" required />
                                            <input name="tFreq" type="number" placeholder="日" className="w-16 text-sm border rounded-lg px-3 py-1" required />
                                            <button className="bg-slate-800 text-white px-3 py-1 rounded-lg text-sm flex items-center gap-1">
                                                <Icons.Plus size={14}/>追加
                                            </button>
                                        </form>
                                    </div>
                                </div>
                                {editingRoomId === room.id && (
                                    <div className="p-4 bg-red-50 flex justify-center">
                                        <button 
                                            onClick={() => setRooms(rooms.filter(r => r.id !== room.id))}
                                            className="text-red-600 text-sm font-bold flex items-center gap-1"
                                        >
                                            <Icons.Trash size={14}/> この部屋を削除
                                        </button>
                                    </div>
                                )}
                            </div>
                        ))}

                        {!showAddRoom ? (
                            <button 
                                onClick={() => setShowAddRoom(true)}
                                className="w-full py-4 border-2 border-dashed border-slate-300 rounded-2xl text-slate-500 font-medium hover:bg-slate-100 transition-colors flex items-center justify-center gap-2"
                            >
                                <Icons.Plus size={20}/> 新しいエリアを追加
                            </button>
                        ) : (
                            <div className="bg-white p-6 rounded-2xl shadow-md border border-blue-200">
                                <h3 className="font-bold mb-4">エリアの新規作成</h3>
                                <input 
                                    value={roomForm.name}
                                    onChange={e => setRoomForm({...roomForm, name: e.target.value})}
                                    placeholder="例: リビング、洗面所" 
                                    className="w-full border rounded-xl px-4 py-2 mb-4"
                                />
                                <div className="flex gap-2">
                                    <button onClick={addRoom} className="flex-1 bg-blue-600 text-white py-2 rounded-xl font-bold">作成</button>
                                    <button onClick={() => setShowAddRoom(false)} className="flex-1 bg-slate-100 text-slate-600 py-2 rounded-xl">中止</button>
                                </div>
                            </div>
                        )}
                    </main>

                    {/* 下部統計バー */}
                    <footer className="fixed bottom-0 left-0 right-0 bg-white/80 backdrop-blur-md border-t border-slate-200 p-3">
                        <div className="max-w-2xl mx-auto flex justify-around text-center">
                            <div>
                                <div className="text-xs text-slate-400">完了</div>
                                <div className="font-bold text-green-600">
                                    {rooms.reduce((acc, r) => acc + r.tasks.filter(t => getUrgency(t.lastCleaned, t.frequency) === 'clean').length, 0)}
                                </div>
                            </div>
                            <div>
                                <div className="text-xs text-slate-400">要掃除</div>
                                <div className="font-bold text-orange-600">
                                    {rooms.reduce((acc, r) => acc + r.tasks.filter(t => ['urgent', 'overdue', 'never'].includes(getUrgency(t.lastCleaned, t.frequency))).length, 0)}
                                </div>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
